<!DOCTYPE html>
<html>
<head>
<title>Project Document Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Main site stylesheet to reuse theme tokens and shared styles -->
<link rel="stylesheet" href="style.css?v=2" />

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<style>
/* Reset + dark theme base using site tokens */
*{margin:0;padding:0;box-sizing:border-box}
html, body { height: 100%; }
body{
  font-family: Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
  color: var(--text);
  background: linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 100%);
  background-attachment: fixed;
  background-size: cover;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* Header - aligned with site aesthetic */
.header{
  background: transparent;
  color: var(--text);
  padding: 18px 20px;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  box-shadow: var(--shadow-1);
}
.header-content{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
.header h1{font-size:22px;margin-bottom:4px;letter-spacing:.3px}
.header p{font-size:12px;color:var(--muted)}
.nav-buttons{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

/* Nav buttons styled similar to site .btn but muted */
.nav-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  height:36px;
  padding:0 12px;
  border-radius:8px;
  background: transparent;
  color: var(--text);
  border:1px solid rgba(255,255,255,0.04);
  cursor:pointer;
  font-size:13px;
  font-weight:700;
  box-shadow:none;
  transition: transform .12s ease, box-shadow .12s ease, background .12s ease, color .12s ease, border-color .12s ease;
}
.nav-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.02); }
.nav-btn.active{ background: var(--accent); color: #041226; border-color: transparent; }
.nav-btn:focus{ outline:2px solid rgba(99,102,241,0.18); }

/* Back button aligned with site button style */
.back-btn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  height:36px;
  padding:0 12px;
  border-radius:8px;
  background: transparent;
  color: var(--text);
  border:1px solid rgba(255,255,255,0.04);
  text-decoration:none;
  font-weight:700;
  transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
}
.back-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.02); }

/* Screens */
.screen{display:none}
.screen.active{display:block}

/* Dashboard area and cards in site theme */
.dashboard{padding:20px;overflow-y:auto}
.dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;margin-bottom:20px}
.dashboard-card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  background-color: var(--card);
  padding: 18px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.04);
  box-shadow: var(--shadow-1);
  transition: transform .16s cubic-bezier(.2,.9,.2,1), box-shadow .16s;
}
.dashboard-card:hover{ transform: translateY(-3px); box-shadow: 0 18px 40px rgba(2,6,23,0.55); }

/* Map container with dark theme */
.map-container{height:calc(100vh - 70px);position:relative}
#fullMap{width:100%;height:100%}

/* Map controls: dark translucent */
.map-controls{
  position:absolute;top:10px;left:10px;z-index:1000;
  background: rgba(255,255,255,0.02);
  color: var(--text);
  padding:10px;border-radius:8px;
  border:1px solid rgba(255,255,255,0.04);
  box-shadow: 0 10px 24px rgba(2,6,23,0.45);
  display:flex;flex-direction:column;gap:8px
}
.map-controls button{
  background: var(--accent);
  color: #041226;
  border:none;
  padding:8px 15px;
  border-radius:8px;
  cursor:pointer;
  font-size:12px;
  font-weight:700;
}
.map-controls button:hover{ transform: translateY(-1px); }

/* Legend: dark translucent card */
.legend{
  position:absolute;bottom:10px;left:10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  color: var(--text);
  padding:12px;border-radius:8px;z-index:1000;
  border:1px solid rgba(255,255,255,0.04);
  box-shadow: 0 10px 24px rgba(2,6,23,0.45);
  font-size:11px
}
.legend h4{font-size:12px;margin-bottom:8px;color:var(--muted)}
.legend-item{margin-bottom:6px;font-size:11px;display:flex;align-items:center;color:var(--muted)}
.legend-color{
  width:16px;height:16px;border-radius:50%;margin-right:8px;display:inline-block;
  border:2px solid rgba(255,255,255,0.25);box-shadow:0 0 5px rgba(0,0,0,0.3);flex-shrink:0
}

/* Sidebar: dark theme card */
.sidebar{
  width:100%;max-width:400px;
  background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
  color: var(--text);
  box-shadow: 0 18px 40px rgba(2,6,23,0.6);
  overflow-y:auto;position:fixed;right:0;top:70px;height:calc(100vh - 70px);z-index:1000;
  transform:translateX(100%);transition:transform 0.3s;
  border-left:1px solid rgba(255,255,255,0.04)
}
.sidebar.open{transform:translateX(0)}
.sidebar-toggle{
  position:absolute;left:-40px;top:50%;transform:translateY(-50%);
  background: transparent;color: var(--text);
  border:1px solid rgba(255,255,255,0.04);
  border-radius:5px 0 0 5px;padding:15px 10px;cursor:pointer;font-size:18px;
  box-shadow: -2px 2px 12px rgba(3,7,18,0.45);
  display:none
}
.sidebar-toggle:hover{background: rgba(255,255,255,0.02)}
.sidebar-header{background: transparent;padding:15px;border-bottom:1px solid rgba(255,255,255,0.04)}
.sidebar-header h2{font-size:16px;margin-bottom:10px}
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:12px 0}
.stat-card{
  background: rgba(255,255,255,0.02);
  padding:12px;border-radius:10px;text-align:center;
  border:1px solid rgba(255,255,255,0.04)
}
.stat-card h3{font-size:20px;color:var(--accent);margin-bottom:3px}
.stat-card p{font-size:10px;color:var(--muted)}
.search-box input{
  width:100%;padding:8px;border:1px solid rgba(255,255,255,0.06);
  border-radius:8px;background: rgba(255,255,255,0.02);color: var(--text);font-size:13px;margin-top:8px
}

/* Alerts list items in dark theme */
.alert-item{
  padding:12px 15px;border-bottom:1px solid rgba(255,255,255,0.04);
  cursor:pointer;transition:background 0.2s;background: transparent;
}
.alert-item:hover{background: rgba(255,255,255,0.02)}
.alert-item.critical{background: rgba(239,68,68,0.08);border-left:4px solid var(--accent-2)}
.alert-item.warning{background: rgba(245,158,11,0.08);border-left:4px solid var(--orange)}
.alert-item h3{font-size:13px;margin-bottom:4px}
.alert-item p{font-size:11px;color:var(--muted);margin-bottom:2px}
.alert-badge{
  display:inline-block;padding:2px 6px;border-radius:10px;font-size:10px;font-weight:700;margin-top:4px
}
.badge-expired{background: var(--accent-2);color:white}
.badge-warning{background: var(--orange);color:white}

/* List view and controls */
.list-view{padding:15px;overflow-y:auto}
.list-controls{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  padding:15px;border-radius:12px;margin-bottom:15px;
  border:1px solid rgba(255,255,255,0.04);
  box-shadow: var(--shadow-1)
}
.list-controls h2{margin-bottom:12px;font-size:18px}
.filter-row{display:grid;grid-template-columns:1fr;gap:12px;margin-bottom:12px}
.filter-group label{font-size:12px;font-weight:700;margin-bottom:4px;display:block;color:var(--muted)}
.filter-group select,.filter-group input{
  width:100%;padding:8px;border:1px solid rgba(255,255,255,0.06);
  border-radius:8px;background: rgba(255,255,255,0.02);color: var(--text);font-size:13px
}
.export-buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.export-btn{
  display:inline-flex;align-items:center;justify-content:center;
  padding:8px 15px;border-radius:8px;cursor:pointer;font-weight:700;font-size:12px;border:none;
  box-shadow: 0 8px 20px rgba(3,7,18,0.5);
}
.export-btn.csv{background:#ed8936;color:white}
.export-btn.excel{background:#48bb78;color:white}
.export-btn.pdf{background:#e53e3e;color:white}
.export-btn:hover{ transform: translateY(-2px); }

/* Table styled to dark theme */
.projects-table{
  background: transparent;border-radius:12px;overflow-x:auto;
  box-shadow: var(--shadow-1); border:1px solid rgba(255,255,255,0.04)
}
table{width:100%;border-collapse:collapse;min-width:800px}
thead{
  background: var(--accent);
  color:#041226;
}
th,td{padding:10px 8px;text-align:left;font-size:12px}
td{border-bottom:1px solid rgba(255,255,255,0.04)}
tbody tr:hover{background: rgba(255,255,255,0.02)}
.status-badge{
  padding:3px 8px;border-radius:10px;font-size:10px;font-weight:700;white-space:nowrap
}
.status-valid{background:#c6f6d5;color:#22543d}
.status-expired{background:#fed7d7;color:#742a2a}
.status-renewal{background:#feebc8;color:#7c2d12}
.edit-btn{
  background: transparent;color: var(--text);
  border:1px solid rgba(255,255,255,0.04);
  padding:6px 12px;border-radius:8px;cursor:pointer;font-size:11px;font-weight:700;
  margin-right:4px;
}
.edit-btn:hover{background: rgba(255,255,255,0.02)}

/* Modal in dark theme */
.modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.88);overflow-y:auto;padding:10px}
.modal-content{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  margin:20px auto;width:100%;max-width:600px;border-radius:12px;
  box-shadow: 0 24px 60px rgba(2,6,23,0.6);
  border:1px solid rgba(255,255,255,0.04)
}
.modal-header{
  background: transparent;color: var(--text);
  padding:15px 20px;border-radius:12px 12px 0 0;
  display:flex;justify-content:space-between;align-items:center;
  border-bottom:1px solid rgba(255,255,255,0.04)
}
.modal-header h2{font-size:16px}
.close{color:var(--text);font-size:24px;font-weight:bold;cursor:pointer}
.modal-body{padding:20px;max-height:60vh;overflow-y:auto}
.form-group{margin-bottom:15px}
.form-group label{display:block;margin-bottom:4px;font-weight:700;font-size:12px;color:var(--muted)}
.form-group input,.form-group select{
  width:100%;padding:8px;border:1px solid rgba(255,255,255,0.06);
  border-radius:8px;background: rgba(255,255,255,0.02);color: var(--text);font-size:13px
}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.doc-section{
  background: rgba(255,255,255,0.02);
  padding:12px;border-radius:10px;margin-bottom:12px;border-left:4px solid var(--accent);
  border:1px solid rgba(255,255,255,0.04)
}
.doc-section h4{font-size:13px;color:var(--accent);margin-bottom:8px}
.btn-primary{
  background: var(--accent);color:#041226;border:none;
  padding:10px 20px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:700;width:100%;margin-top:10px
}
.btn-primary:hover{ transform: translateY(-1px); }
.btn-secondary{
  background: transparent;color: var(--text);
  border:1px solid rgba(255,255,255,0.04);
  padding:10px 20px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:700;width:100%;margin-top:8px
}
.btn-secondary:hover{ background: rgba(255,255,255,0.02); }

/* Mobile alert toggle */
.mobile-alert-toggle{
  display:none;position:fixed;bottom:20px;right:20px;background: var(--accent);color:#041226;
  border:none;padding:15px;border-radius:50%;
  box-shadow:0 12px 30px rgba(3,7,18,0.45);
  cursor:pointer;z-index:999;font-size:20px;width:60px;height:60px
}

/* Map canvas in dark while tiles load */
.map-canvas {
  width: 100%;
  height: 420px;
  border-radius: 8px;
  overflow: hidden;
  background: rgba(255,255,255,0.02);
  border:1px solid rgba(255,255,255,0.04);
}

/* NEW: summary sites/documents modal table */
.summary-sites-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}
.summary-sites-table th,
.summary-sites-table td {
  padding: 8px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  text-align: left;
}
.summary-sites-table thead {
  background: rgba(255,255,255,0.04);
  color: var(--text);
}

/* Responsive tweaks */
@media (max-width:768px){
  .header h1{font-size:20px}
  .header p{font-size:11px}
  .nav-buttons{width:100%;justify-content:space-between}
  .nav-btn{flex:1;padding:6px 10px;font-size:11px;text-align:center}
  .dashboard-grid{grid-template-columns:1fr;gap:12px}
  .sidebar{width:100%;max-width:100%}
  .sidebar-toggle{display:block}
  .mobile-alert-toggle{display:block}
  .map-controls{flex-direction:row;gap:5px}
  .map-controls button{padding:6px 10px;font-size:11px}
  .legend{font-size:10px;padding:8px}
  .legend h4{font-size:11px}
  .filter-row{gap:10px}
  table{font-size:11px}
  th,td{padding:8px 6px}
  .projects-table{overflow-x:scroll}
  .modal{padding:5px}
  .modal-content{margin:10px auto}
  .form-row{grid-template-columns:1fr}
}
@media (max-width:480px){
  .header h1{font-size:18px}
  .nav-btn{font-size:10px;padding:5px 8px}
  .dashboard-card{padding:15px}
  th,td{padding:6px 4px;font-size:10px}
  .edit-btn{padding:6px 10px;font-size:10px}
}
</style>
</head>
<body>
<div class="header">
  <div class="header-content">
    <div>
      <h1>üìã Project Document Tracker</h1>
      <p>Professional Edition</p>
    </div>
    <div class="nav-buttons">
      <!-- Back to main page button -->
      <a href="/dashboard" class="back-btn" title="Back to main">
        ‚¨Ö Back
      </a>

      <button class="nav-btn active" onclick="showScreen('dashboard')">üìä Dashboard</button>
      <button class="nav-btn" onclick="showScreen('map')">üó∫Ô∏è Map</button>
      <button class="nav-btn" onclick="showScreen('list')">üìã List</button>
    </div>
  </div>
</div>

<button class="mobile-alert-toggle" onclick="toggleSidebar(getCurrentScreen())" id="alertToggle">üîî</button>

<div id="dashboard" class="screen active">
  <div class="dashboard" id="dashboardContent">
    <h2 style="margin-bottom:20px;color:var(--text);font-size:22px">üìä Document Status Overview</h2>

    <!-- NEW: Add button identical in behavior to Map view (opens add/edit modal) -->
    <div style="margin-bottom:12px;">
      <button class="nav-btn" onclick="openEditModal()">‚ûï Add</button>
    </div>

    <div class="dashboard-grid" id="dashboardBoxes"></div>
  </div>
  <div class="sidebar" id="dashSidebar">
    <button class="sidebar-toggle" onclick="toggleSidebar('dash')">‚óÄ</button>
    <div class="sidebar-header">
      <h2>‚ö†Ô∏è Document Alerts</h2>
      <div class="stats">
        <div class="stat-card"><h3 id="dash-stat-expired">0</h3><p>Expired</p></div>
        <div class="stat-card"><h3 id="dash-stat-expiring">0</h3><p>Expiring</p></div>
        <div class="stat-card"><h3 id="dash-stat-total">0</h3><p>Total</p></div>
      </div>
      <div class="search-box"><input type="text" id="dashSearchAlerts" placeholder="üîç Search..." onkeyup="filterAlerts('dash')"></div>
    </div>
    <div id="dashAlertsList"></div>
  </div>
</div>

<div id="map" class="screen">
  <div class="map-container" id="mapContainer">
    <div class="map-controls">
      <button onclick="openEditModal()">‚ûï Add</button>
      <button onclick="reloadDocumentTracker()">üîÑ Refresh</button>
    </div>
    <div id="fullMap"></div>
    <div class="legend">
      <h4>Status</h4>
      <div class="legend-item"><span class="legend-color" style="background:#48bb78"></span><span>Valid</span></div>
      <div class="legend-item"><span class="legend-color" style="background:#ed8936"></span><span>Renewal</span></div>
      <div class="legend-item"><span class="legend-color" style="background:#e53e3e"></span><span>Expired</span></div>
    </div>
    <div class="sidebar" id="mapSidebar">
      <button class="sidebar-toggle" onclick="toggleSidebar('map')">‚óÄ</button>
      <div class="sidebar-header">
        <h2>‚ö†Ô∏è Alerts</h2>
        <div class="stats">
          <div class="stat-card"><h3 id="map-stat-expired">0</h3><p>Expired</p></div>
          <div class="stat-card"><h3 id="map-stat-expiring">0</h3><p>Expiring</p></div>
          <div class="stat-card"><h3 id="map-stat-total">0</h3><p>Total</p></div>
        </div>
        <div class="search-box"><input type="text" id="mapSearchAlerts" placeholder="üîç Search..." onkeyup="filterAlerts('map')"></div>
      </div>
      <div id="mapAlertsList"></div>
    </div>
  </div>
</div>

<div id="list" class="screen">
  <div class="list-view" id="listContent">
    <div class="list-controls">
      <h2>üìã Projects List</h2>
      <div class="filter-row">
        <div class="filter-group"><label>Search</label><input type="text" id="filterSearch" placeholder="Search..." onkeyup="applyFilters()"></div>
        <div class="filter-group"><label>Status</label><select id="filterStatus" onchange="applyFilters()"><option value="all">All</option><option value="valid">Valid</option><option value="expired">Expired</option><option value="renewal">Renewal</option></select></div>
        <div class="filter-group"><label>Document</label><select id="filterDocument" onchange="applyFilters()"><option value="all">All</option><option value="istifaa">Istifaa</option><option value="amc">AMC</option><option value="doe_noc">DOE NOC</option><option value="coc">COC</option><option value="tpi">TPI</option></select></div>
      </div>
      <div class="export-buttons">
        <button class="export-btn csv" onclick="exportToCSV()">üìã CSV</button>
        <button class="export-btn excel" onclick="exportToExcel()">üìä Excel</button>
        <button class="export-btn pdf" onclick="exportToPDF()">üìÑ PDF</button>

        <!-- NEW: Import Excel button + hidden file input -->
        <button class="export-btn excel" onclick="triggerExcelImport()">‚¨ÜÔ∏è Import Excel</button>
        <input id="excel-import-input" type="file" accept=".xlsx,.xls,.csv" style="display:none" />
      </div>
    </div>
    <div class="projects-table">
      <table>
        <thead><tr><th>ID</th><th>Name</th><th>Location</th><th>Status</th><th>Exp</th><th>Ren</th><th>Val</th><th>Files</th><th>Actions</th></tr></thead>
        <tbody id="projectsTableBody"></tbody>
      </table>
    </div>
  </div>
  <div class="sidebar" id="listSidebar">
    <button class="sidebar-toggle" onclick="toggleSidebar('list')">‚óÄ</button>
    <div class="sidebar-header">
      <h2>‚ö†Ô∏è Alerts</h2>
      <div class="stats">
        <div class="stat-card"><h3 id="list-stat-expired">0</h3><p>Expired</p></div>
        <div class="stat-card"><h3 id="list-stat-expiring">0</h3><p>Expiring</p></div>
        <div class="stat-card"><h3 id="list-stat-total">0</h3><p>Total</p></div>
      </div>
      <div class="search-box"><input type="text" id="listSearchAlerts" placeholder="üîç Search..." onkeyup="filterAlerts('list')"></div>
    </div>
    <div id="listAlertsList"></div>
  </div>
</div>

<!-- Main Edit Modal: ONLY site + expiry info now -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>‚úèÔ∏è Edit Site & Expiry</h2>
      <span class="close" onclick="closeEditModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div id="editProjectInfo" style="background: rgba(255,255,255,0.02); padding:12px; border-radius:10px; margin-bottom:15px; border:1px solid rgba(255,255,255,0.04)"></div>
      <form id="editForm" onsubmit="saveEdit(event)">
        <div id="editDocuments"></div>
        <button type="submit" class="btn-primary">üíæ Save Changes</button>
        <button type="button" class="btn-secondary" onclick="closeEditModal()">Cancel</button>
        <!-- NEW: Delete button, shown only when editing an existing row -->
        <button type="button" id="editDeleteBtn" class="btn-secondary" style="display:none;background: var(--accent-2); color: #fff; border: none; margin-top:8px;">üóëÔ∏è Delete</button>
      </form>
    </div>
  </div>
</div>

<!-- Documents-only modal for upload/download + delete -->
<div id="docsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>üìÑ Documents</h2>
      <span class="close" onclick="closeDocsModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div id="docsProjectInfo" style="background: rgba(255,255,255,0.02); padding:12px; border-radius:10px; margin-bottom:15px; border:1px solid rgba(255,255,255,0.04)"></div>
      <form id="docsForm" onsubmit="saveDocs(event)">
        <input type="hidden" id="docs-id" value="">

        <div class="doc-section">
          <h4>ISTIFAA Document</h4>
          <div id="docs-info-istifaa" style="font-size:11px;color:var(--muted);margin-bottom:4px;"></div>
          <div class="form-group">
            <label>Upload / Replace</label>
            <input type="file" id="docs-file-istifaa" accept="application/pdf,image/*">
          </div>
          <button type="button"
                  class="btn-secondary"
                  style="margin-top:4px;padding:6px 10px;font-size:11px;width:auto"
                  onclick="deleteDocFile('istifaa')">üóëÔ∏è Delete ISTIFAA File</button>
        </div>

        <div class="doc-section">
          <h4>AMC Document</h4>
          <div id="docs-info-amc" style="font-size:11px;color:var(--muted);margin-bottom:4px;"></div>
          <div class="form-group">
            <label>Upload / Replace</label>
            <input type="file" id="docs-file-amc" accept="application/pdf,image/*">
          </div>
          <button type="button"
                  class="btn-secondary"
                  style="margin-top:4px;padding:6px 10px;font-size:11px;width:auto"
                  onclick="deleteDocFile('amc')">üóëÔ∏è Delete AMC File</button>
        </div>

        <div class="doc-section">
          <h4>DOE NOC Document</h4>
          <div id="docs-info-doe_noc" style="font-size:11px;color:var(--muted);margin-bottom:4px;"></div>
          <div class="form-group">
            <label>Upload / Replace</label>
            <input type="file" id="docs-file-doe_noc" accept="application/pdf,image/*">
          </div>
          <button type="button"
                  class="btn-secondary"
                  style="margin-top:4px;padding:6px 10px;font-size:11px;width:auto"
                  onclick="deleteDocFile('doe_noc')">üóëÔ∏è Delete DOE NOC File</button>
        </div>

        <div class="doc-section">
          <h4>COC Document</h4>
          <div id="docs-info-coc" style="font-size:11px;color:var(--muted);margin-bottom:4px;"></div>
          <div class="form-group">
            <label>Upload / Replace</label>
            <input type="file" id="docs-file-coc" accept="application/pdf,image/*">
          </div>
          <button type="button"
                  class="btn-secondary"
                  style="margin-top:4px;padding:6px 10px;font-size:11px;width:auto"
                  onclick="deleteDocFile('coc')">üóëÔ∏è Delete COC File</button>
        </div>

        <div class="doc-section">
          <h4>TPI Document</h4>
          <div id="docs-info-tpi" style="font-size:11px;color:var(--muted);margin-bottom:4px;"></div>
          <div class="form-group">
            <label>Upload / Replace</label>
            <input type="file" id="docs-file-tpi" accept="application/pdf,image/*">
          </div>
          <button type="button"
                  class="btn-secondary"
                  style="margin-top:4px;padding:6px 10px;font-size:11px;width:auto"
                  onclick="deleteDocFile('tpi')">üóëÔ∏è Delete TPI File</button>
        </div>

        <button type="submit" class="btn-primary">üíæ Save Documents</button>
        <button type="button" class="btn-secondary" onclick="closeDocsModal()">Cancel</button>
      </form>
    </div>
  </div>
</div>

<!-- Summary sites/documents modal (for ALL DOCUMENTS VALID / ALL DOCUMENTS NOT VALID / TOTAL DOCS RENEWAL / TOTAL DOCS EXPIRED) -->
<div id="summarySitesModal" class="modal">
  <!-- widened to make everything visible -->
  <div class="modal-content" style="max-width:1200px;">
    <div class="modal-header">
      <h2 id="summarySitesTitle">Sites</h2>
      <span class="close" onclick="closeSummarySitesModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div id="summarySitesInfo" style="font-size:12px;color:var(--muted);margin-bottom:10px;"></div>
      <div class="projects-table" style="margin-top:0;">
        <table class="summary-sites-table">
          <thead>
            <tr>
              <th>SN</th>
              <th>Facility Type</th>
              <th>Building Name</th>
              <th>Building Code</th>
              <th>Status / Document</th>
            </tr>
          </thead>
          <tbody id="summarySitesBody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Load the new, API-backed logic (replaces the old inline script/localStorage) -->
<script src="document.js?v=4"></script>
</body>
</html>
