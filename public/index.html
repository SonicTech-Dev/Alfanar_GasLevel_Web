<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Tank Level â€” Sonic</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css?v=2" />
  <style>
    /* Minimal modal styling for history chart - stronger dim so the whole app fades to black behind the modal */
    /* Increased overall modal size: wider and taller while keeping the same internal layout */
    .history-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.88);
      z-index: 1200;
      padding: 32px;
    }
    .history-panel {
      width: 100%;
      max-width: 1200px; /* increased width */
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 12px;
      padding: 20px;
      color: var(--text);
      box-shadow: 0 20px 60px rgba(2,6,23,0.6);
      z-index: 1210;
    }
    .history-actions { display:flex; gap:8px; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .history-msg { margin-top:8px; color:var(--muted); font-size:13px; }
    @media (max-width:640px){
      .history-panel { padding:12px; }
    }

    /* Small tweaks so the new view modal looks very clean */
    .tank-info-view .history-panel {
      max-width: 920px;
      padding: 22px;
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(12,16,34,0.98), rgba(10,14,30,0.98));
      border: 1px solid rgba(255,255,255,0.03);
      box-shadow: 0 30px 90px rgba(2,6,23,0.75);
    }
  </style>
</head>
<body>
  <!-- LOGIN MODAL (server-backed) -->
  <div id="login-modal" class="login-modal" role="dialog" aria-modal="true" aria-label="Login to Tank Level" style="display:none;">
    <div class="login-panel" role="document">
      <h2 style="margin:0 0 8px 0;">Please sign in</h2>
      <p style="margin:0 0 12px 0;color:var(--muted);font-size:13px;">Enter your credentials to continue.</p>

      <form id="login-form" autocomplete="off" style="display:flex;flex-direction:column;gap:8px;">
        <label style="font-size:13px;color:var(--muted);">Username
          <input id="login-username" name="username" type="text" autocomplete="username" class="graph-title-input" required />
        </label>
        <label style="font-size:13px;color:var(--muted);">Password
          <input id="login-password" name="password" type="password" autocomplete="current-password" class="graph-title-input" required />
        </label>

        <div style="display:flex;gap:8px;align-items:center;margin-top:6px;">
          <button type="submit" class="btn" style="min-width:96px;">Sign in</button>
          <button type="button" id="login-cancel" class="history-close" style="background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.04);">Cancel</button>
          <div id="login-error" style="color:#ffdede;margin-left:8px;display:none;font-size:13px;"></div>
        </div>
      </form>
    </div>
  </div>

  <header class="topbar">
    <div class="brand-with-logo">
      <!-- Logo on the left, sized professionally -->
      <div class="header-logo" aria-hidden="true">
        <img src="/static/logo.png" alt="Sonic logo" class="logo-img" />
      </div>

      <div class="brand">
        <h1>Tank Level</h1>
        <p class="subtitle">Real-time tank monitoring</p>
      </div>

      <!-- View toggle placed to the right of brand/legend area -->
      <div style="margin-left:auto; display:flex; align-items:center; gap:8px;">
        <!-- Documents button: clean, professional, matches existing header styling -->
        <a href="/Document-Tracker" id="documents-btn" class="btn" role="button" title="Open Document Tracker" style="background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.04);text-decoration:none;display:inline-flex;align-items:center;gap:8px;">
          <!-- simple document icon + label -->
          <span aria-hidden="true">ðŸ“„</span>
          <span>Documents</span>
        </a>

        <!-- NEW: Dashboard button -->
        <a href="/dashboard" id="dashboard-btn" class="btn" role="button" title="Open Dashboard" style="background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.04);text-decoration:none;display:inline-flex;align-items:center;gap:8px;">
          <span aria-hidden="true">ðŸ“Š</span>
          <span>Dashboard</span>
        </a>

        <!-- The toggle uses the existing .btn style but is visually muted to fit the header -->
        <button id="toggle-view-btn" class="btn" type="button" aria-pressed="false" title="Toggle list/card view" style="background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.04);">
          <span id="toggle-view-icon" aria-hidden="true">â˜°</span>
          <span id="toggle-view-label" style="margin-left:8px;">List view</span>
        </button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- LEGEND UI (in-page, inside .container) ï¿½ï¿½ï¿½ using exact card visuals for swatches -->
    <details class="legend-panel" aria-label="Legend">
      <summary>Legend</summary>
      <div class="legend-content">
        <div class="legend-section">
          <div class="legend-title">Gas level indicators</div>
          <div class="legend-grid">
            <div class="legend-item">
              <!-- exact same dot used in cards -->
              <span class="status-dot status-green" aria-hidden="true"></span>
              <span class="legend-label">Normal</span>
            </div>
            <div class="legend-item">
              <span class="status-dot status-orange" aria-hidden="true"></span>
              <span class="legend-label">Low</span>
            </div>
            <div class="legend-item">
              <span class="status-dot status-red" aria-hidden="true"></span>
              <span class="legend-label">High</span>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <div class="legend-title">Battery level indicators</div>
          <div class="legend-grid">
            <div class="legend-item">
              <!-- exact same pill used in cards -->
              <span class="battery-dot status-green" aria-hidden="true"></span>
              <span class="legend-label">Full</span>
            </div>
            <div class="legend-item">
              <span class="battery-dot status-orange" aria-hidden="true"></span>
              <span class="legend-label">Normal</span>
            </div>
            <div class="legend-item">
              <span class="battery-dot status-red" aria-hidden="true"></span>
              <span class="legend-label">Low</span>
            </div>
          </div>
        </div>

        <div class="legend-divider" role="separator" aria-hidden="true"></div>

        <div class="legend-section">
          <div class="legend-title">Icons</div>
          <div class="legend-icons" role="list">
            <div class="legend-icon" role="listitem">
              <!-- history icon -->
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M3 3v18h18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><path d="M7 14v-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 14v-8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><path d="M17 14v-2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg>
              <span>History</span>
            </div>

            <div class="legend-icon" role="listitem">
              <!-- refresh icon -->
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M21 12a9 9 0 10-2.25 5.625" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><path d="M21 3v6h-6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg>
              <span>Refresh</span>
            </div>

            <div class="legend-icon" role="listitem">
              <!-- device info icon -->
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M12 2v4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><rect x="6" y="6" width="12" height="14" rx="2" stroke="currentColor" stroke-width="1.4" fill="none"></rect><path d="M12 11v5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"></path><circle cx="12" cy="9" r="0.6" fill="currentColor"></circle></svg>
              <span>Device Info</span>
            </div>

            <div class="legend-icon" role="listitem">
              <!-- map icon -->
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M12 2C8.686 2 6 4.686 6 8c0 4.5 6 12 6 12s6-7.5 6-12c0-3.314-2.686-6-6-6z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="12" cy="8" r="2.4" fill="currentColor"/></svg>
              <span>Map</span>
            </div>
          </div>
        </div>
      </div>
    </details>

    <!-- Template for tank cards (used by script.js). Includes Battery % and GSM % placeholder -->
    <template id="tank-card-template">
      <article class="tank-card" role="group" aria-label="Tank card">
        <header class="tank-card-header">
          <h3 class="tank-name">Site Name</h3>
          <div class="tank-meta">
            <!-- Battery line (existing apps often show battery percent here) -->
            <div class="battery">
              Battery: <span class="battery-percent">--%</span>
            </div>

            <!-- NEW: GSM RSSI percent (will be updated by script.js) -->
            <div class="gsm" aria-hidden="false">
              GSM: <span class="gsm-percent">--%</span>
            </div>
          </div>
        </header>

        <!-- Main content (level bar / percentage) -->
      <div class="tank-body">
          <div class="level">
            <div class="level-percent">--%</div>
            <!-- visual bar (script.js may populate width) -->
            <div class="level-bar"><div class="level-bar-fill" style="width:0%"></div></div>
          </div>

          <div class="tank-actions">
            <button class="btn view-history">History</button>
          </div>
        </div>

        <footer class="tank-footer" style="font-size:12px;color:var(--muted);">
          <div class="last-updated">Updated: --</div>
        </footer>
      </article>
    </template>

    <!-- Grid of tank cards -->
    <section id="tanks" class="tanks-grid" aria-live="polite">
      <!-- Cards are generated dynamically by script.js -->
    </section>

    <!-- NEW: list view container (hidden by default) -->
    <section id="tanks-list" class="tanks-list" style="display:none;" aria-live="polite" aria-label="Tank list view">
      <!-- populated by script.js when list view active -->
    </section>

    <div id="global-error" class="error" style="display:none;"></div>

    <!-- ADMIN MENU (hidden by default). This includes the form to add/update site locations. -->
    <aside id="admin-menu" class="admin-menu" role="region" aria-hidden="true" style="display:none;">
      <div class="admin-menu-inner">
        <h2>Administrator Menu.</h2>

        <!-- Visitor Tracking button -->
        <div>
          <button id="visitor-tracking-btn" class="btn" type="button">Visitor Tracking</button>
        </div>

        <!-- Show All Devices Map -->
        <div style="margin-top:8px;">
          <button id="open-all-map" class="btn" type="button">Show All Devices Map</button>
        </div>

        <!-- Device Information button (no action yet) -->
        <div style="margin-top:8px;">
          <button id="admin-device-info-btn" class="btn" type="button" title="Device Information">Device Information</button>
        </div>

        <!-- NEW: Change Password button (visible only to top admin Sonic) -->
        <div style="margin-top:8px;">
          <button id="admin-change-password-btn" class="btn" type="button" title="Change Password" style="display:none;">Change Password</button>
        </div>

        <!-- Manage Site / Location form (visible to admins) -->
        <div style="margin-top:14px;">
          <strong style="display:block;margin-bottom:8px;color:var(--muted)">Manage Site / Location</strong>

          <div style="display:flex;flex-direction:column;gap:8px;">
            <select id="admin-device-select" class="graph-title-input" aria-label="Choose device (optional)">
              <option value="">â€” choose device (optional) â€”</option>
            </select>

            <input id="admin-terminal-id" class="graph-title-input" placeholder="Terminal ID (or leave blank and pick device)" />
            <input id="admin-site-name" class="graph-title-input" placeholder="Site name (optional)" />
            <input id="admin-location-link" class="graph-title-input" placeholder="Location link (Google Maps URL)" />
            <div style="display:flex;gap:8px;">
              <input id="admin-lat" class="graph-title-input" placeholder="Latitude" />
              <input id="admin-lng" class="graph-title-input" placeholder="Longitude" />
            </div>

            <div style="display:flex;gap:8px;align-items:center;">
              <button id="admin-site-save" class="btn" type="button">Save Site</button>
              <span id="admin-site-msg" style="color:var(--muted);font-size:13px;"></span>
            </div>

            <div style="color:var(--muted);font-size:12px;">
              You can provide Terminal ID directly or pick the device from the dropdown to populate it.
            </div>
          </div>
        </div>
      </div>
    </aside>
<!-- User menu for normal (non-admin) users â€” hidden by default -->
<div id="user-menu" style="display:none;margin-top:16px;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.04);box-shadow: 0 12px 30px rgba(3,7,18,0.45);" role="region" aria-hidden="true">
  <div style="display:flex;flex-direction:column;gap:8px;">
    <div style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap;">
      <button id="user-open-all-map" class="btn" type="button">Show All Devices Map</button>
      <button id="user-device-info-btn" class="btn" type="button" title="Device Information">Device Information</button>
      <!-- NEW: Change Password (visible only to editor Alfanar_Admin1) -->
      <button id="user-change-password-btn" class="btn" type="button" title="Change Password" style="display:none;">Change Password</button>
    </div>
  </div>
</div>
  </main>

  <footer class="footer">
    <span>Powered by SONIC</span>
  </footer>

  <!-- Chart.js (used by the history modal/chart) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Luxon + adapter so Chart.js uses local timezone via the browser -->
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1"></script>

  <!-- Chart.js zoom/pan plugin (wheel zoom) -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2/dist/chartjs-plugin-zoom.min.js"></script>

  <!-- jsPDF for PDF export -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
    (function () {
      // Server-backed login using /api/login
      const modal = document.getElementById('login-modal');
      const form = document.getElementById('login-form');
      const usernameInput = document.getElementById('login-username');
      const passwordInput = document.getElementById('login-password');
      const errorEl = document.getElementById('login-error');
      const cancelBtn = document.getElementById('login-cancel');

      function showModal() {
        modal.style.display = 'flex';
        document.body.classList.add('modal-open');
        setTimeout(() => usernameInput.focus(), 50);
      }

      function hideModal() {
        modal.style.display = 'none';
        document.body.classList.remove('modal-open');
      }

      // Always require login on every page load: show modal immediately
      showModal();

      // Form submit handler -> POST /api/login
      form.addEventListener('submit', async function (ev) {
        ev.preventDefault();
        errorEl.style.display = 'none';
        const u = (usernameInput.value || '').trim();
        const p = (passwordInput.value || '').trim();
        if (!u || !p) {
          errorEl.textContent = 'Please enter username and password.';
          errorEl.style.display = 'block';
          return;
        }
        try {
          const resp = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: u, password: p })
          });
          const json = await resp.json().catch(() => ({}));
          if (!resp.ok || !json.ok) {
            errorEl.textContent = json.error || 'Invalid username or password.';
            errorEl.style.display = 'block';
            passwordInput.value = '';
            passwordInput.focus();
            return;
          }

          // Role mapping: admin/editor/viewer
          const role = String(json.role || '').trim();

          try { window._clientAuthenticated = true; } catch (e) { /* ignore */ }
          try { window._clientIsAdmin = (role === 'admin'); } catch (e) { /* ignore */ }
          try { window._clientUsername = json.username || u; } catch (e) { /* ignore */ }

          hideModal();

          // Dispatch event that the rest of the app can listen to
          try { window.dispatchEvent(new Event('app:login')); } catch (e) { /* ignore */ }

          // If the app exposes a start function, call it immediately
          try { if (typeof window.appStart === 'function') window.appStart(); } catch (e) { /* ignore */ }
        } catch (err) {
          errorEl.textContent = 'Login failed. Please try again.';
          errorEl.style.display = 'block';
        }
      });

      cancelBtn.addEventListener('click', function () {
        // simply reload the page; since auth isn't persisted, reload will still show the login modal
        try { window._clientAuthenticated = false; } catch (e) { /* ignore */ }
        try { window._clientIsAdmin = false; } catch (e) { /* ignore */ }
        try { window._clientUsername = ''; } catch (e) { /* ignore */ }
        hideModal();
        window.location.reload();
      });

      // Accessibility: pressing Escape when modal visible does nothing (to avoid accidentally bypassing)
      modal.addEventListener('keydown', function (ev) {
        if (ev.key === 'Escape') {
          ev.stopPropagation();
          ev.preventDefault();
        }
      });

      // Utility: password policy validation
      function isStrongPassword(pw) {
        if (!pw || pw.length < 8) return false;
        const hasLower = /[a-z]/.test(pw);
        const hasUpper = /[A-Z]/.test(pw);
        const hasDigit = /[0-9]/.test(pw);
        return hasLower && hasUpper && hasDigit;
      }

      // Show Change Password modal
      function showPasswordModal() {
        const actor = (window._clientUsername || '').trim();
        const isAdmin = !!window._clientIsAdmin;
        const modalWrap = document.createElement('div');
        modalWrap.className = 'history-modal';
        // Build role-based target options
        const targets = [];
        if (actor === 'Sonic' && isAdmin) {
          targets.push({ value: 'Sonic', label: 'Admin Password (Sonic)' });
          targets.push({ value: 'Alfanar_Admin1', label: 'Editor Password (Alfanar_Admin1)' });
          targets.push({ value: 'Alfanar_GasLevel1', label: 'Viewer Password (Alfanar_GasLevel1)' });
        } else if (actor === 'Alfanar_Admin1') {
          targets.push({ value: 'Alfanar_Admin1', label: 'Admin Password' });
          targets.push({ value: 'Alfanar_GasLevel1', label: 'Viewer Password' });
        } else {
          // No permission: do not open
          alert('You do not have permission to change passwords.');
          return;
        }

        const optionsHtml = targets.map(t => `<option value="${t.value}">${t.label}</option>`).join('');
        modalWrap.innerHTML = `
          <div class="history-panel" role="dialog" aria-modal="true" aria-label="Change Password">
            <div class="history-actions">
              <div style="display:flex;align-items:center;gap:12px;">
                <strong>Change Password</strong>
              </div>
              <div style="display:flex;align-items:center;gap:8px;">
                <div class="history-controls">
                  <button class="history-close" type="button">Close</button>
                </div>
              </div>
            </div>

            <div style="display:grid;grid-template-columns:1fr 1fr; gap:16px;">
              <div style="grid-column: 1 / -1;">
                <label style="display:block;margin-bottom:6px;color:var(--muted);font-size:13px;">Target</label>
                <select id="pw-target" class="graph-title-input">${optionsHtml}</select>
              </div>

              <div>
                <label style="display:block;margin-bottom:6px;color:var(--muted);font-size:13px;">Current Password</label>
                <input id="pw-current" type="password" class="graph-title-input" placeholder="Enter your current password" />
              </div>

              <div>
                <label style="display:block;margin-bottom:6px;color:var(--muted);font-size:13px;">New Password</label>
                <input id="pw-new" type="password" class="graph-title-input" placeholder="Create new password" />
              </div>

              <div style="grid-column: 1 / -1;">
                <label style="display:block;margin-bottom:6px;color:var(--muted);font-size:13px;">Confirm New Password</label>
                <input id="pw-confirm" type="password" class="graph-title-input" placeholder="Repeat new password" />
              </div>
            </div>

            <div style="display:flex;gap:8px;align-items:center;margin-top:12px;">
              <button id="pw-save" class="btn" type="button" disabled>Save</button>
              <div id="pw-msg" class="history-msg" style="margin-top:0;"></div>
            </div>
          </div>
        `;
        document.body.appendChild(modalWrap);
        document.body.classList.add('modal-open');

        const closeBtn = modalWrap.querySelector('.history-close');
        const saveBtn = modalWrap.querySelector('#pw-save');
        const targetSel = modalWrap.querySelector('#pw-target');
        const currentInput = modalWrap.querySelector('#pw-current');
        const newInput = modalWrap.querySelector('#pw-new');
        const confirmInput = modalWrap.querySelector('#pw-confirm');
        const msgEl = modalWrap.querySelector('#pw-msg');

        function cleanup() {
          modalWrap.remove();
          document.body.classList.remove('modal-open');
        }
        closeBtn.addEventListener('click', cleanup);
        modalWrap.addEventListener('click', (e) => { if (e.target === modalWrap) cleanup(); });

        function validateForm() {
          const curOk = (currentInput.value || '').trim().length > 0;
          const newPw = (newInput.value || '').trim();
          const conf = (confirmInput.value || '').trim();
          const strong = isStrongPassword(newPw);
          const match = newPw.length > 0 && newPw === conf;
          if (!strong) {
            msgEl.textContent = 'Password must be at least 8 characters, with lowercase, uppercase, and a number.';
            msgEl.style.color = '#ffdede';
          } else if (!match) {
            msgEl.textContent = 'Passwords do not match.';
            msgEl.style.color = '#ffdede';
          } else {
            msgEl.textContent = '';
          }
          saveBtn.disabled = !(curOk && strong && match);
        }

        [currentInput, newInput, confirmInput].forEach(inp => {
          inp.addEventListener('input', validateForm);
        });
        validateForm();

        saveBtn.addEventListener('click', async () => {
          const actorUsername = (window._clientUsername || '').trim();
          const targetUsername = targetSel.value;
          const currentPassword = (currentInput.value || '').trim();
          const newPassword = (newInput.value || '').trim();
          msgEl.textContent = 'Savingâ€¦';
          msgEl.style.color = 'var(--muted)';

          try {
            const resp = await fetch('/api/password/change', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ actorUsername, targetUsername, currentPassword, newPassword })
            });
            const json = await resp.json().catch(() => ({}));
            if (!resp.ok || !json.ok) {
              msgEl.textContent = json.error || 'Failed to change password.';
              msgEl.style.color = '#ffdede';
              return;
            }
            msgEl.textContent = 'Password changed successfully.';
            msgEl.style.color = '#22c55e';

            // If the user changed their own password, force re-login
            if (actorUsername === targetUsername) {
              setTimeout(() => {
                try { window._clientAuthenticated = false; } catch (e) {}
                try { window._clientIsAdmin = false; } catch (e) {}
                try { window._clientUsername = ''; } catch (e) {}
                cleanup();
                // Show login modal again
                showModal();
              }, 800);
            } else {
              setTimeout(() => cleanup(), 800);
            }
          } catch (err) {
            msgEl.textContent = 'Error: ' + (err && err.message ? err.message : 'Unknown');
            msgEl.style.color = '#ffdede';
          }
        });
      }

      // Display the Change Password buttons based on role/username
      function updateChangePasswordButtonsVis() {
        const actor = (window._clientUsername || '').trim();
        const adminBtn = document.getElementById('admin-change-password-btn');
        const userBtn = document.getElementById('user-change-password-btn');
        if (adminBtn) {
          // Only Sonic (top admin)
          adminBtn.style.display = (actor === 'Sonic') ? '' : 'none';
          adminBtn.onclick = (e) => { e.stopPropagation(); showPasswordModal(); };
        }
        if (userBtn) {
          // Only editor Alfanar_Admin1
          userBtn.style.display = (actor === 'Alfanar_Admin1') ? '' : 'none';
          userBtn.onclick = (e) => { e.stopPropagation(); showPasswordModal(); };
        }
      }

      // Update buttons once on login and on page load (in case of rapid init)
      window.addEventListener('app:login', updateChangePasswordButtonsVis);
      document.addEventListener('DOMContentLoaded', updateChangePasswordButtonsVis);
    })();
  </script>

  <!-- socket.io client from CDN (ensures `io` exists before script.js runs) -->
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>

  <script src="script.js?v=2"></script>
</body>
</html>
